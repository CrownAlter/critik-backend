# =============================================================================
# CRITIK APPLICATION CONFIGURATION
# =============================================================================
# Art review and discussion social platform backend
# 
# ENVIRONMENT VARIABLES REQUIRED:
# - JWT_SECRET: Secret key for JWT signing (min 32 characters for HS256)
# - DB_URL: Database connection URL (default: PostgreSQL 18 on localhost)
# - DB_USERNAME: Database username
# - DB_PASSWORD: Database password
# 
# OPTIONAL ENVIRONMENT VARIABLES:
# - JWT_EXPIRATION: Token expiration in milliseconds (default: 24 hours)
# - CORS_ALLOWED_ORIGINS: Comma-separated list of allowed origins
# - FILE_UPLOAD_DIR: Directory for uploaded files
# - MAX_FILE_SIZE: Maximum upload file size
# - Rate limit settings (see RATE LIMITING section below)
# =============================================================================

spring.application.name=Critik

# =============================================================================
# JWT AUTHENTICATION SETTINGS
# =============================================================================
# SECURITY: JWT_SECRET must be at least 256 bits (32+ characters) for HS256
# Generate a secure secret: openssl rand -base64 32
jwt.secret=${JWT_SECRET}

# Access token expiration: 15 minutes (900000ms) by default
# Short-lived for security - use refresh tokens to get new access tokens
jwt.expiration=${JWT_EXPIRATION:900000}

# Refresh token expiration: 7 days (604800000ms) by default
# Long-lived but stored in database and can be revoked
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:604800000}

# Refresh token cleanup interval: 1 hour (3600000ms) by default
# Expired and revoked tokens are cleaned up periodically
jwt.refresh-cleanup-interval=${JWT_REFRESH_CLEANUP_INTERVAL:3600000}

# =============================================================================
# DATABASE CONFIGURATION - PostgreSQL 18
# =============================================================================
# Default connection to PostgreSQL 18 with database 'critik'
# Override with DB_URL environment variable for different configurations
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/critik}
spring.datasource.username=${DB_USERNAME:critik}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection pool settings (HikariCP - Spring Boot default)
# PRODUCTION: Tune these based on your database and expected load
# Rule of thumb: pool size = (core_count * 2) + effective_spindle_count
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${DB_MIN_IDLE:5}
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# JPA/Hibernate settings
# PRODUCTION: Change to 'validate' and use Flyway for migrations
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:update}
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=true

# PostgreSQL 18 dialect - use latest PostgreSQL dialect
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# =============================================================================
# FLYWAY DATABASE MIGRATIONS
# =============================================================================
# PRODUCTION: Enable Flyway and create migration scripts in src/main/resources/db/migration
# Naming convention: V1__Initial_schema.sql, V2__Add_artist_name.sql, etc.
spring.flyway.enabled=${FLYWAY_ENABLED:false}
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration

# =============================================================================
# FILE UPLOAD SETTINGS
# =============================================================================
file.upload-dir=${FILE_UPLOAD_DIR:uploads}

# Maximum file sizes
spring.servlet.multipart.max-file-size=${MAX_FILE_SIZE:10MB}
spring.servlet.multipart.max-request-size=${MAX_REQUEST_SIZE:10MB}

# =============================================================================
# CORS CONFIGURATION
# =============================================================================
# Comma-separated list of allowed origins
# PRODUCTION: Set to your actual frontend domain(s)
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:4200,https://critik-frontend.onrender.com}

# =============================================================================
# RATE LIMITING CONFIGURATION
# =============================================================================
# Rate limits help prevent abuse, brute force attacks, and DoS attempts.
# Limits are per IP address for unauthenticated requests, per user for authenticated.
#
# Categories:
# - LOGIN: Strict limits on /auth/login to prevent brute force
# - REGISTER: Very strict on /auth/register to prevent spam accounts
# - SEARCH: Moderate limits to prevent scraping
# - API: Standard limits for general API usage

# Login: 5 attempts per minute (prevents brute force password guessing)
rate-limit.auth.login.requests=${RATE_LIMIT_LOGIN:5}

# Register: 3 attempts per minute (prevents spam account creation)
rate-limit.auth.register.requests=${RATE_LIMIT_REGISTER:3}

# API: 60 requests per minute (standard usage)
rate-limit.api.requests=${RATE_LIMIT_API:60}

# Search: 30 requests per minute (prevents scraping)
rate-limit.search.requests=${RATE_LIMIT_SEARCH:30}

# Bucket cache expiration (minutes) - how long to track IP/user
rate-limit.cache.expiration=${RATE_LIMIT_CACHE_EXPIRATION:10}

# =============================================================================
# SERVER SETTINGS
# =============================================================================
server.port=${PORT:8080}

# PRODUCTION: Enable compression for better performance
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/plain
server.compression.min-response-size=1024

# Graceful shutdown - wait for active requests to complete
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# =============================================================================
# LOGGING
# =============================================================================
# PRODUCTION: Set to WARN or ERROR
logging.level.root=${LOG_LEVEL:INFO}
logging.level.com.application.critik=${APP_LOG_LEVEL:DEBUG}
logging.level.org.springframework.security=${SECURITY_LOG_LEVEL:INFO}

# Log rate limiting events
logging.level.com.application.critik.security.RateLimitFilter=${RATE_LIMIT_LOG_LEVEL:INFO}

# =============================================================================
# ACTUATOR ENDPOINTS (Monitoring & Health Checks)
# =============================================================================
# Health endpoint is public for load balancer health checks
# Other endpoints require authentication in production

management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=${ACTUATOR_HEALTH_DETAILS:when-authorized}
management.endpoint.health.probes.enabled=true

# Kubernetes-style health probes
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# Application info
management.info.env.enabled=true
info.app.name=Critik
info.app.description=Art review and discussion platform
info.app.version=@project.version@
